# Информация к исследованию

Структура данных в МонгоДБ - отдельный документ по фильму, который содержит список айди юзеров с их оценками к этому фильму. Загружено 10кк лайков (1000 фильмов, у каждого по 10 000 оценок)

Структура данных в Кликхаусе - строка с айди фильма, айди юзера и оценкой. Загружено 10кк строк


# Результаты исследований

## Запрос средней оценки по фильму

| Database   | Insertion, sec | Selection no load, sec | Selection with load, sec |
|------------|----------------|------------------------|--------------------------|
| Clickhouse | 0.656          | 0.0126                 | 0.0212                   |
| MongoDB    | 8.3977         | 0.0116                 | 0.0119                   |

## Запрос количества лайков и дизлайков

| Database   | Insertion, sec | Selection no load, sec | Selection with load, sec |
|------------|----------------|------------------------|--------------------------|
| Clickhouse | 0.656          | 0.0108                 | 0.0197                   |
| MongoDB    | 8.3977         | 0.0094                 | 0.0112                   |

Clickhouse insertion time is reported for batches of 100 000. Configuration - one shard, no replicas

MongoDB insertion time is reported for batches of 100 000. Configuration - one shard, no replicas

#Выводы

Скорость обработки запросов у этих БД отличается не сильно, но при нагрузке Clickhouse просидает сильнее по скорости чтения и очень сильно просидает на запись

Решено использовать MongoDB - так как она показывает лучше скорости при высокой нагрузке и намного быстрее вставляет данные. Плюс если оставить для этих целей уже используемый Clickhouse - то нагрузка на него будет еще больше и он будет работать медленее


#Повтор исследований

Команда для первого запуска исследования(запустит контейнеры с базами, создаст базы и загрузит по 10кк лайков в каждую базу):
```bash
make first-up
```

Команды для запросов(выполняет по запросу на средную оценку и на количество лайков + дизлайков по 100 фильмам и считает среднее время каждого запроса):
```bash
make query-clickhouse-data
make query-mongo-data
```

Команда для проверки времени вставки (вставляет 100 000 лайков):
```bash
make insert-clickhouse-data
make insert-mongo-data
```
